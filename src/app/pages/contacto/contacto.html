<main class="container my-5 contact-surface">
  <header class="mb-4">
    <h1 class="text-borgona">Contacto</h1>
    <p class="muted-small">
      Contáctanos para aclarar dudas, proponer colaboraciones o solicitar asesoría sobre nuestros programas y servicios de apoyo a la investigación.
      <span class="dot-sep">•</span>
      <span id="openStatus" class="status-pill" aria-live="polite">Cargando horario…</span>
    </p>

    <!-- Chips de motivo (precargan el selector) -->
    <div class="chip-group" role="group" aria-label="Motivos rápidos">
      <button type="button" class="chip" data-subject="general">Información</button>
      <button type="button" class="chip" data-subject="colaboracion">Colaboración</button>
      <button type="button" class="chip" data-subject="publicacion">Publicación</button>
      <button type="button" class="chip" data-subject="convocatoria">Convocatoria</button>
      <button type="button" class="chip" data-subject="soporte">Soporte técnico</button>
      <button type="button" class="chip" data-subject="otro">Otro</button>
    </div>
  </header>

  <div class="row g-4">
    <!-- Formulario de contacto -->
    <section class="col-lg-7" aria-labelledby="contactFormHeading">
      <div class="card border-borgona contact-card">
        <div class="card-header bg-light">
          <h2 id="contactFormHeading" class="mb-0">Envíanos un mensaje</h2>
        </div>

        <div class="card-body">
          <form id="contactForm" class="needs-validation" novalidate method="post" action="/api/contacto">
            <fieldset class="fieldset">
              <legend class="legend">Metadatos básicos</legend>

              <div class="row g-3">
                <div class="col-md-6">
                  <label for="contactName" class="form-label">Nombre completo <span class="text-danger">*</span></label>
                  <input type="text" id="contactName" name="name" class="form-control input-custom"
                         placeholder="Tu nombre" required maxlength="120" aria-required="true" />
                  <div class="invalid-feedback">Introduce tu nombre.</div>
                </div>

                <div class="col-md-6">
                  <label for="contactEmail" class="form-label">Correo electrónico <span class="text-danger">*</span></label>
                  <input type="email" id="contactEmail" name="email" class="form-control input-custom"
                         placeholder="correo@dominio.com" required aria-required="true" />
                  <div class="invalid-feedback">Introduce un correo válido.</div>
                </div>

                <div class="col-md-6">
                  <label for="contactEmail" class="form-label">Confirmar Correo Electrónico <span class="text-danger">*</span></label>
                  <input type="email" id="contactEmail" name="email" class="form-control input-custom"
                         placeholder="correo@dominio.com" required aria-required="true" />
                  <div class="invalid-feedback">Introduce un correo válido.</div>
                </div>
                
                <div class="col-md-6">
                  <label for="contactSubject" class="form-label">Asunto <span class="text-danger">*</span></label>
                  <select id="contactSubject" name="subject" class="form-select input-custom"
                          required aria-required="true" aria-describedby="subjectHint">
                    <option value="">Selecciona...</option>
                    <option value="general">Consulta general</option>
                    <option value="colaboracion">Colaboración</option>
                    <option value="publicacion">Publicación / Divulgación</option>
                    <option value="convocatoria">Convocatoria</option>
                    <option value="soporte">Soporte técnico</option>
                    <option value="otro">Otro</option>
                  </select>
                  <div id="subjectHint" class="form-text muted-small" aria-live="polite">
                    Elige un motivo para ver recomendaciones.
                  </div>
                  <div class="invalid-feedback">Selecciona un asunto.</div>
                </div>

                <div class="col-md-6">
                  <label for="contactPhone" class="form-label">Teléfono (opcional)</label>
                  <input type="tel" id="contactPhone" name="phone" class="form-control input-custom"
                         placeholder="(55) 1234 5678" pattern="^[0-9()+\-\s]{7,20}$" aria-describedby="phoneHelp">
                  <div id="phoneHelp" class="form-text muted-small">Opcional; admite números y símbolos (+ - () ).</div>
                </div>
              </div>
            </fieldset>

            <fieldset class="fieldset mt-3">
              <legend class="legend">Mensaje</legend>

              <div class="row g-3">
                <div class="col-12">
                  <label for="contactMessage" class="form-label">Mensaje <span class="text-danger">*</span></label>
                  <textarea id="contactMessage" name="message" class="form-control input-custom"
                            rows="6" required maxlength="5000"
                            placeholder="Comparte el contexto, objetivo y datos útiles para responder."></textarea>
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="form-text muted-small">
                      Ejemplo: “Fallo al adjuntar PDF en Solicitudes (ID 2314), navegador Chrome 128, hoy 10:32”.
                    </div>
                    <div id="msgCounter" class="counter" aria-live="polite">0 / 5000</div>
                  </div>
                  <div class="invalid-feedback">Escribe tu mensaje.</div>
                </div>

                <div class="col-12">
                  <div class="form-check">
                    <input id="contactConsent" name="consent" class="form-check-input" type="checkbox" required>
                    <label for="contactConsent" class="form-check-label muted-small">
                      Acepto el uso de mis datos para responder esta consulta
                    </label>
                    <div class="invalid-feedback">Debes aceptar para enviar tu mensaje.</div>
                  </div>
                </div>
              </div>
            </fieldset>

            <div class="mt-4 d-flex gap-2 justify-content-end">
              <button type="reset" class="btn btn-outline-secondary">Limpiar</button>
              <button type="button" class="btn btn-borgona" id="contactSubmitBtn">
                <span class="btn-label">Enviar mensaje</span>
              </button>
            </div>

            <div id="contactFormMessage" class="mt-3 pub-inline-feedback" role="status" aria-live="polite" style="display:none;"></div>
          </form>
        </div>
      </div>
    </section>

    <!-- Información institucional -->
    <aside class="col-lg-5" aria-labelledby="infoHeading">
      <div class="card border-borgona mb-3 contact-card">
        <div class="card-header bg-light d-flex align-items-center justify-content-between">
          <h3 id="infoHeading" class="mb-0">Información institucional</h3>
          <span class="badge rounded-pill bg-open-now" id="openNowPill" aria-hidden="true">—</span>
        </div>

        <div class="card-body">
          <div class="kv-row">
            <p class="kv-label">Dirección</p>
            <p class="kv-value small-muted">Av. Principal 123, Col. Centro, Texcoco de Mora, Estado de México</p>
          </div>

          <div class="kv-row">
            <p class="kv-label">Teléfono</p>
            <div class="d-flex align-items-center gap-2">
              <p class="kv-value small-muted mb-0" id="instPhone">(55) 1234 5678</p>
              <button type="button" class="btn btn-ghost-borgona btn-sm" id="copyPhone" aria-label="Copiar teléfono">Copiar</button>
            </div>
          </div>

          <div class="kv-row">
            <p class="kv-label">Correo</p>
            <div class="d-flex align-items-center gap-2">
              <p class="kv-value small-muted mb-0" id="instEmail">informes&#64;SIMEX.mx</p>
              <button type="button" class="btn btn-ghost-borgona btn-sm" id="copyEmail" aria-label="Copiar correo">Copiar</button>
            </div>
          </div>

          <div class="kv-row">
            <p class="kv-label">Horario de atención</p>
            <p class="kv-value small-muted mb-0">Lunes a viernes, 9:00 - 17:00</p>
          </div>

          <hr>

          <h6 class="text-borgona">Canales alternos</h6>
          <ul class="list-unstyled small-muted">
              <li><strong>Soporte técnico:</strong> soporte&#64;SIMEX.mx</li>
              <li><strong>Prensa y difusión:</strong> prensa&#64;SIMEX.mx</li>  
          </ul>
        </div>
      </div>
    </aside>

    <!-- Modal: confirmación de mensaje enviado -->
    <div class="modal fade" id="contactSuccessModal" tabindex="-1" aria-labelledby="contactSuccessLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-borgona text-center">
          <div class="modal-header border-0 justify-content-center">
            <h5 class="modal-title text-borgona fw-bold" id="contactSuccessLabel">Mensaje enviado</h5>
          </div>
          <div class="modal-body">
            <p class="mb-0">Tu mensaje ha sido enviado correctamente.</p>
            <p class="muted-small mt-2 mb-0">Nuestro equipo revisará tu solicitud y te responderá a la brevedad.</p>
          </div>
          <div class="modal-footer border-0 justify-content-center">
            <button type="button" class="btn btn-borgona" data-bs-dismiss="modal">Aceptar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
